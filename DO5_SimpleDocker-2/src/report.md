## Готовый докер

Загрузка образа nginx через команду `docker pull`
![docker_pull](1/1.png)
Проверка наличия образа через команду `docker images`
![docekr_images](1/2.png)
Запуск образа через комнаду `docker run`
![docker_run](1/3.png)
Проверка наличия процесса через команду `docker ps`
![docker_ps](1/4.png)
Просмотр информации о контейнере через команду \
`docker inspect %container_id%`
![docker_inspect](1/5.png)
Размер докер образа
![docker_shmsize](1/6.png)
Его IP
![docker_ip](1/7.png)
Замапленый порт\
![docker_port](1/8.png)\
Остановка докер образа и проверка его остановки
![docker_stop](1/9.png)
Запуск образа с замапленными портами
![docker_map](1/10.png)
Проверка работы сервера
![docker_localhost](1/11.png)
Перезагрузка докер образа и проверка наличия процесса
![docker_restart](1/12.png)

## Операции с контейнером

Вывод содержимого файла nginx.conf
![docker_exec](2/2.1.png)

Создание файла nginx.conf и настройка в нем по пути /status отдачу страницы статуса сервера
![docker_nginx_conf](2/2.2.png)
Коприование nginx.conf внутрь докер образа, перезагрузка nginx, проверка статуса сервера
![docker_nginx_conf_cp](2/2.4.png)
Экспорт докер контейнера в файл, остановка контейнера
![docker_export](2/2.5.png)
Удаление докер образа и проверка того, что он удален
![docker_rmi](2/2.6.png)
Удаление остановленного контейнера
![docker_rm](2/2.7.png)
Импорт сохраненного контейнера, его запуск и проверка работоспособности
![docker_import](2/2.8.png)
Проверяем, что по адресу localhost:80/status отдается страничка со статусом сервера nginx.
![docker_import](2/2.9.png)
Содержимое файла nginx.conf;
![docker_import](2/2.10.png)

## Part 3. Мини веб-сервер  
* Пишем мини сервер на C и FastCgi, который будет возвращать простейшую страничку с надписью `Hello World!`  
![Part_3_1.png](3/3.1.png)  


* Пишем свой nginx.conf, который будет проксировать все запросы с 81 порта на 127.0.0.1:8080  
![Part_3_2.png](3/3.2.png)  


* Качаем образ nginx, запускаем контейнер, копируем c файл сервера и conf файл nginx  
![Part_3_3.png](3/3.3.png)  


* Заходим в контейнер командой `docker exec -it keiraski_server bash`, обновляем репозитории,   
![Part_3_4.png](3/3.4.png)  

устанавливаем gcc, spawn-fcgi и libfcgi-dev флаг `-У` для `install` означает автоматическое согласие на все запросы во время установки

![Part_3_5.png](3/3.5.png)  



* Компилируем и запускаем сервер  
![Part_3_6.png](3/3.6.png)  
![Part_3_7.png](3/3.7.png)  

* проверяем нашу страничку  
![Part_3_8.png](3/3.8.png)  

## Part4. Свой докер

* Напишем свой docker-образ, который собирает исходники 3-й части, запускает на порту `80`, после копирует внутрь написанный нами `nginx.conf` и, наконец, запускает `nginx` (ниже приведены файлы `entrypoint.sh` 

![docker4_runsh](4/4.1.png) 
и `Dockerfile`, 
![docker4_dockerfile](4/4.2.png)  
файлы `nginx.conf` и `server.c` остаются с 3-й части) 

* Соберем написанный docker-образ через команду `docker build`, при этом указав имя и тэг нашего контейнера  
![docker4_build.png](4/4.4.png)  

* Теперь удостоверимся, что все собралось, проверив наличие соответствующего образа командой `docker images`  
![docker4_images.png](4/4.5.png)  

* После запустим собранный docker-образ с мапингом порта `81` на порт `80` локальной машины, а также мапингом  `./nginx` внутрь контейнера по адресу конфигурационных файлов nginx'а, и проверим, что страничка написанного сервера по адресу 
![docker4_run_server.png](4/4.6.png)

```
!!Примечание!!
Если при проверке адреса localhost вы увидете ошибку 502, остановите запущенный docker-образ, после исправьте ошибки в конфигурационных файлах и заново запустите собранный docker-образ
```

* Теперь добавим в файл `nginx.conf` проксирование странички `/status`, по которой необходимо отдавать статус сервера `nginx  
![docker4_nginx.png](4/4.7.png)

* Теперь перезапустим `nginx` в своем docker-образе командой `nginx -s reload`  
![docker4_reload_serv.png](4/4.8.png)

* Наконец, проверим, что по адресу `localhost/status` выдается страничка со статусом сервера `nginx`  
![docker4_success.png](4/4.9.png)


## Part5. Dockle

```
!!Примечание!!
Перед выполнением данного шага необходимо установить утилиту [dockle], инструкция по установке [https://github.com/goodwithtech/dockle], если машина не видит утилиту [https://github.com/aquasecurity/trivy/issues/2432], также рекомендую добавить своего пользователя в группу [docker]
```

* Просканируем docker-образ из предыдущего задания на предмет наличия ошибок командой `dockle [image_id|repository]`  
![part5_troubles.png](5/5.err.png)

Выходит ошибка которую я не смог исправить и не нашел решения поэтому нашел другой путь... Создаю Docker образ с утилитой dockle в которую помещаю для проверки мой контейнер miniserver:part4

![part5_troubles.png](5/5.1.png)

* Далее исправим конфигурационные файлы docker-образа так, чтобы при проверке через утилиту `dockle` не возникало ошибок и предупреждений (для Part5 я создал отдельный контейнер с тэгом `part5`, куда подгрузил измененные конфиги, конфиг в nginx не удалось исправить уязвимость CIS-DI-0010 и я создал образ ubuntu в которой все уязвимости были устранены)

![part5_new_build.png](5/5.2.png)

* Опять проверяем на наличие уязвимостей и видим что критических уязвимистей нет

![part5_success.png](5/5.3.png)

## Part6. Basic Docker Compose

```
!!Примечание!!
Перед выполнением данного шага необходимо установить утилиту [docker-compose], инструкция по установке [https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-ubuntu-20-04]
```

* Перепишем скрипт entrypoint для второго контейнера 
![Part_6_1.png](6/6.1.png)  


* Перепишем _**nginx.conf**_ для проксирования  
![Part_6_2.png](6/6.1_1.png)  


* напишем **_docker-compose.yml_**  
![Part_6_4.png](6/6.1_2.png)  

* Теперь сбилдим контейнер командой `docker-compose build`
![part6_build.png](6/6.2.png)  

* После необходимо поднять сбилженный контейнер командой `docker compose up`
![part6_dockerup.png](6/6.3.png)  

* В завершение насладимся плодами своей усердной работы, удостоверившись, что по адресу `localhost` отдается страничка с надписью `Hello World!`

![part6_success.png](6/6.4.png)  